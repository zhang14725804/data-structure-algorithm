/*
	ç»™å®šä¸€ä¸ªåªåŒ…å« '(' å’Œ ')' çš„å­—ç¬¦ä¸²ï¼Œæ‰¾å‡ºæœ€é•¿çš„åŒ…å«æœ‰æ•ˆæ‹¬å·çš„å­ä¸²çš„é•¿åº¦ã€‚

	æ‹¬å·åºåˆ—ï¼š
		ï¼ˆ1ï¼‰æ¯ä¸ªå·¦æ‹¬å·å”¯ä¸€å¯¹åº”ä¸€ä¸ªå³æ‹¬å·
		ï¼ˆ2ï¼‰ä¸€ä¸ªæ‹¬å·åºåˆ—åˆæ³•  <==> ï¼ˆè‹¥ï¼šå·¦æ‹¬å·è®°ä¸º1ï¼Œå³æ‹¬å·è®°ä¸º-1ï¼‰æ‰€æœ‰å‰ç¼€å’Œ>=0,ä¸”æ€»å’Œ==0
		ä¹Ÿå°±æ˜¯å·¦æ‹¬å·æ•°é‡å¤§äºç­‰äºå³æ‹¬å·ï¼Œä¸”å·¦å³æ‹¬å·æ•°é‡ç›¸ç­‰
	(()()) ==== 1 1 -1 1 -1 1

*/

/*
	æ–¹æ³•1ï¼šæ­£ç€åˆ¤æ–­ä¸€æ¬¡ï¼Œåè½¬ä¹‹ååœ¨åˆ¤æ–­ä¸€æ¬¡
*/
func longestValidParentheses1(s1 string) int {
	// è½¬ä¸ºruneæ•°ç»„
	s := []rune(s1)
	// æ­£ç€åšä¸€æ¬¡
	res := work(s)
	// (question)åè½¬ï¼Œ(æ²¡æƒ³åˆ°åè½¬ğŸ˜…)ï¼Œå˜æ¢å·¦å³æ‹¬å·ä¹‹åå†åšä¸€æ¬¡
	s = reverse(s)
	// for _, c := range s {
	// 	c ^= 1 // éœ€è¦ä¿®æ”¹æ•°ç»„å…ƒç´ ï¼Œè¿™æ ·ä¿®æ”¹æ˜¯é”™çš„ğŸ˜…
	// }
	// å·¦æ‹¬å·æ¢æˆå³æ‹¬å·ï¼ˆå› ä¸ºä»–ä»¬çš„asciiå€¼åªæ˜¯æœ€åä¸€ä½ç›¸å·®1ï¼Œæ‰€ä»¥ç›´æ¥ç”¨^=æ“ä½œï¼‰
	for i, _ := range s {
		s[i] ^= 1
	}
	return MaxInt(res, work(s))
}

/*
	åˆ†ä¸ºä¸‰ç§æƒ…å†µ(æ ¹æ®æ‹¬å·åºåˆ—çš„æ€§è´¨)
	cnt<0ï¼Œå½“å‰å­æ®µä¸åˆæ³•ï¼Œstart=i,cnt=0
	cnt>0ï¼Œç»§ç»­
	cnt==0ï¼Œ[start,i]æ˜¯åˆæ³•çš„åºåˆ—
*/
func work(s []rune) int {
	res := 0
	for i, start, cnt := 0, 0, 0; i < len(s); i++ {
		if s[i] == '(' {
			cnt++
		} else {
			cnt--
			if cnt < 0 {
				start = i + 1
				cnt = 0
			} else if cnt == 0 {
				res = MaxInt(res, i-start+1)
			}
		}
	}
	return res
}

// åè½¬å­—ç¬¦ä¸²
func reverse(a []rune) []rune {
	for i, j := 0, len(a)-1; i < j; i, j = i+1, j-1 {
		a[i], a[j] = a[j], a[i]
	}
	return a
}

/*
	åˆ©ç”¨æ ˆ
*/
func longestValidParentheses2(s string) int {
	// ç”¨sliceæ¨¡æ‹Ÿæ ˆ
	stk := make([]int, 0)
	res := 0
	// startï¼Œè®°å½•æ¯ä¸ªåˆ†æ®µçš„å‰ä¸€ä¸ªä½ç½®
	for i, start := 0, -1; i < len(s); i++ {
		// å½“å‰è¿™ä¸ªå­—ç¬¦æ˜¯å·¦æ‹¬å·
		if s[i] == '(' {
			stk = append(stk, i)
		} else {
			// å½“å‰æ˜¯å³æ‹¬å·
			if len(stk) > 0 {
				// stk.pop
				stk = stk[:len(stk)-1]
				if len(stk) > 0 {
					// stk.top
					res = compare(res, i-stk[len(stk)-1], true)
				} else {
					res = compare(res, i-start, true)
				}
			} else {
				// å½“å‰å³æ‹¬å·æ˜¯åˆ†ç•Œç‚¹
				start = i
			}
		}
	}
	return res
}

/*
	åŠ¨æ€è§„åˆ’(question)
	dp [ i ] ä»£è¡¨ä»¥ä¸‹æ ‡ i ç»“å°¾çš„åˆæ³•åºåˆ—çš„æœ€é•¿é•¿åº¦
*/