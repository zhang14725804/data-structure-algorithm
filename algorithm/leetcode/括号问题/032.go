/*
	æ–¹æ³•1ï¼š
		é¦–å…ˆï¼Œåˆ¤æ–­åˆæ³•å­—ç¬¦çš„é•¿åº¦ï¼š
		1. cnt è®°å½•å·¦å³æ‹¬å·æ•°é‡ï¼Œå·¦æ‹¬å·+1ï¼Œå³æ‹¬å·-1
		2. start è®°å½•èµ·å§‹ä½ç½®
		3. éå†å­—ç¬¦ä¸²
		åˆ†ä¸ºä¸‰ç§æƒ…å†µ(æ ¹æ®æ‹¬å·åºåˆ—çš„æ€§è´¨)
			cnt<0ï¼Œå½“å‰å­æ®µä¸åˆæ³•ï¼Œstart=i,cnt=0
			cnt>0ï¼Œç»§ç»­
			cnt==0ï¼Œ[start,i]æ˜¯åˆæ³•çš„åºåˆ—
		ç„¶åï¼Œæ­£ç€åˆ¤æ–­ä¸€æ¬¡ï¼Œåè½¬ä¹‹ååœ¨åˆ¤æ–­ä¸€æ¬¡
*/
func longestValidParentheses1(s1 string) int {
	// è½¬ä¸ºruneæ•°ç»„
	s := []rune(s1)
	// æ­£ç€åšä¸€æ¬¡
	res := work(s)
	// åè½¬å­—ç¬¦ä¸²
	s = reverse(s)
	// å·¦æ‹¬å·æ¢æˆå³æ‹¬å·ï¼ˆå› ä¸ºä»–ä»¬çš„asciiå€¼åªæ˜¯æœ€åä¸€ä½ç›¸å·®1ï¼Œæ‰€ä»¥ç›´æ¥ç”¨^=æ“ä½œï¼‰
	// c ^= 1 // éœ€è¦ä¿®æ”¹æ•°ç»„å…ƒç´ ï¼Œè¿™æ ·ä¿®æ”¹æ˜¯é”™çš„ğŸ˜…
	for i, _ := range s {
		s[i] ^= 1
	}
	// (question)åè½¬ï¼Œ(æ²¡æƒ³åˆ°åè½¬ğŸ˜…)ï¼Œå˜æ¢å·¦å³æ‹¬å·ä¹‹åå†åšä¸€æ¬¡
	return MaxInt(res, work(s))
}

/*
	åˆ†ä¸ºä¸‰ç§æƒ…å†µ(æ ¹æ®æ‹¬å·åºåˆ—çš„æ€§è´¨)
	cnt<0ï¼Œå½“å‰å­æ®µä¸åˆæ³•ï¼Œstart=i,cnt=0
	cnt>0ï¼Œç»§ç»­
	cnt==0ï¼Œ[start,i]æ˜¯åˆæ³•çš„åºåˆ—
*/
func work(s []rune) int {
	res := 0
	// è®°å½•å·¦å³æ‹¬å·æ•°é‡ï¼Œå·¦æ‹¬å·+1ï¼Œå³æ‹¬å·-1
	cnt := 0
	// è®°å½•èµ·å§‹ä½ç½®
	start := 0
	for i := 0; i < len(s); i++ {
		if s[i] == '(' {
			// å·¦æ‹¬å·
			cnt++
		} else {
			// å³æ‹¬å·
			cnt--
			// ä¸åˆæ³•åºåˆ—ï¼Œè·³è¿‡
			if cnt < 0 {
				start = i + 1
				cnt = 0
			} else if cnt == 0 {
				// åˆæ³•åºåˆ—
				res = MaxInt(res, i-start+1)
			}
		}
	}
	return res
}

// åè½¬å­—ç¬¦ä¸²
func reverse(a []rune) []rune {
	for i, j := 0, len(a)-1; i < j; i, j = i+1, j-1 {
		a[i], a[j] = a[j], a[i]
	}
	return a
}

/*
	æ–¹æ³•2:åˆ©ç”¨æ ˆ TODO ğŸ˜…
		ä»å·¦åˆ°å³æ‰«æå­—ç¬¦ä¸²ï¼Œæ ˆé¡¶ä¿å­˜å½“å‰æ‰«æçš„æ—¶å€™ï¼Œåˆæ³•åºåˆ—å‰çš„ä¸€ä¸ªä½ç½®ä½ç½®ä¸‹æ ‡æ˜¯å¤šå°‘
			1. æ‰«æåˆ°å·¦æ‹¬å·ï¼Œå°±å°†å½“å‰ä½ç½®å…¥æ ˆ
			2. æ‰«æåˆ°å³æ‹¬å·ï¼Œå°±å°†æ ˆé¡¶å‡ºæ ˆï¼ˆä»£è¡¨æ ˆé¡¶çš„å·¦æ‹¬å·åŒ¹é…åˆ°äº†å³æ‹¬å·ï¼‰ï¼Œç„¶ååˆ†ä¸¤ç§æƒ…å†µ
				æ ˆä¸ç©ºï¼Œé‚£ä¹ˆå°±ç”¨å½“å‰çš„ä½ç½®å‡å»æ ˆé¡¶çš„å­˜çš„ä½ç½®ï¼Œç„¶åå°±å¾—åˆ°å½“å‰åˆæ³•åºåˆ—çš„é•¿åº¦ï¼Œç„¶åæ›´æ–°ä¸€ä¸‹æœ€é•¿é•¿åº¦ã€‚
				æ ˆæ˜¯ç©ºçš„ï¼Œè¯´æ˜ä¹‹å‰æ²¡æœ‰ä¸ä¹‹åŒ¹é…çš„å·¦æ‹¬å·ï¼Œé‚£ä¹ˆå°±å°†å½“å‰çš„ä½ç½®å…¥æ ˆã€‚
*/
func longestValidParentheses2(s string) int {
	// ç”¨sliceæ¨¡æ‹Ÿæ ˆ
	stk := make([]int, 0)
	res := 0
	// startï¼Œè®°å½•æ¯ä¸ªåˆ†æ®µçš„å‰ä¸€ä¸ªä½ç½®
	start := -1
	for i := 0; i < len(s); i++ {
		// å½“å‰è¿™ä¸ªå­—ç¬¦æ˜¯å·¦æ‹¬å·
		if s[i] == '(' {
			stk = append(stk, i)
		} else {
			// å½“å‰æ˜¯å³æ‹¬å·
			if len(stk) > 0 {
				// å‡ºæ ˆ
				stk = stk[:len(stk)-1]
				if len(stk) > 0 {
					// stk.top
					res = Max(res, i-stk[len(stk)-1])
				} else {
					res = Max(res, i-start)
				}
			} else {
				// å½“å‰å³æ‹¬å·æ˜¯åˆ†ç•Œç‚¹
				start = i
			}
		}
	}
	return res
}

/*
	åŠ¨æ€è§„åˆ’(question)
	TODO ğŸ˜…
*/